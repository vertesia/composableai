{"version":3,"file":"vertesia-fusion-ux.js","sources":["esm/validation/schemas.js","esm/validation/fuzzyMatch.js","esm/validation/validateTemplate.js","esm/fusion-fragment/FieldRenderer.js","esm/fusion-fragment/TableRenderer.js","esm/fusion-fragment/FusionFragmentContext.js","esm/fusion-fragment/ChartRenderer.js","esm/fusion-fragment/SectionRenderer.js","esm/fusion-fragment/FusionFragmentRenderer.js","esm/fusion-fragment/FusionFragmentHandler.js","esm/validation/formatErrors.js","esm/render/textPreview.js"],"sourcesContent":["/**\n * JSON Schemas for template validation using AJV\n */\n/**\n * Schema for field options (select dropdowns)\n */\nconst FieldOptionSchema = {\n    type: 'object',\n    properties: {\n        label: { type: 'string' },\n        value: { type: 'string' }\n    },\n    required: ['label', 'value'],\n    additionalProperties: false\n};\n/**\n * Schema for a single field template\n */\nexport const FieldTemplateSchema = {\n    type: 'object',\n    properties: {\n        label: { type: 'string' },\n        key: { type: 'string' },\n        format: {\n            type: 'string',\n            enum: ['text', 'number', 'currency', 'percent', 'date', 'boolean'],\n            nullable: true\n        },\n        unit: { type: 'string', nullable: true },\n        editable: { type: 'boolean', nullable: true },\n        inputType: {\n            type: 'string',\n            enum: ['text', 'number', 'date', 'select', 'checkbox'],\n            nullable: true\n        },\n        options: {\n            type: 'array',\n            items: FieldOptionSchema,\n            nullable: true\n        },\n        min: { type: 'number', nullable: true },\n        max: { type: 'number', nullable: true },\n        highlight: {\n            type: 'string',\n            enum: ['success', 'warning', 'error', 'info'],\n            nullable: true\n        },\n        tooltip: { type: 'string', nullable: true },\n        decimals: { type: 'number', nullable: true },\n        currency: { type: 'string', nullable: true }\n    },\n    required: ['label', 'key'],\n    additionalProperties: false\n};\n/**\n * Schema for a table column template\n */\nexport const ColumnTemplateSchema = {\n    type: 'object',\n    properties: {\n        header: { type: 'string' },\n        key: { type: 'string' },\n        format: {\n            type: 'string',\n            enum: ['text', 'number', 'currency', 'percent', 'date', 'boolean'],\n            nullable: true\n        },\n        width: { type: 'string', nullable: true },\n        align: {\n            type: 'string',\n            enum: ['left', 'center', 'right'],\n            nullable: true\n        },\n        currency: { type: 'string', nullable: true },\n        decimals: { type: 'number', nullable: true },\n        highlight: {\n            type: 'string',\n            enum: ['success', 'warning', 'error', 'info'],\n            nullable: true\n        }\n    },\n    required: ['header', 'key'],\n    additionalProperties: false\n};\n/**\n * Schema for Vega-Lite spec (flexible - allows any valid Vega-Lite properties)\n * We validate structure loosely and let Vega-Lite handle detailed validation\n * Note: Using loose typing since VegaLiteSpec is intentionally flexible\n */\nexport const VegaLiteSpecSchema = {\n    type: 'object',\n    additionalProperties: true, // Allow any Vega-Lite properties\n    // We don't enforce specific properties since Vega-Lite has many valid forms\n};\n/**\n * Schema for chart template\n * Note: Using loose typing for spec since VegaLiteSpec is flexible\n */\nexport const ChartTemplateSchema = {\n    type: 'object',\n    properties: {\n        title: { type: 'string', nullable: true },\n        description: { type: 'string', nullable: true },\n        spec: VegaLiteSpecSchema,\n        height: { type: 'number', nullable: true },\n        width: { type: 'number', nullable: true },\n        dataKey: { type: 'string', nullable: true }\n    },\n    required: ['spec'],\n    additionalProperties: false\n};\n/**\n * Schema for a section template\n * Note: Using type assertion due to ChartTemplate's flexible VegaLiteSpec\n */\nexport const SectionTemplateSchema = {\n    type: 'object',\n    properties: {\n        title: { type: 'string' },\n        layout: {\n            type: 'string',\n            enum: ['grid-2', 'grid-3', 'grid-4', 'list', 'table', 'chart'],\n            nullable: true\n        },\n        collapsed: { type: 'boolean', nullable: true },\n        fields: {\n            type: 'array',\n            items: FieldTemplateSchema,\n            nullable: true\n        },\n        columns: {\n            type: 'array',\n            items: ColumnTemplateSchema,\n            nullable: true\n        },\n        dataKey: { type: 'string', nullable: true },\n        chart: {\n            ...ChartTemplateSchema,\n            nullable: true\n        }\n    },\n    required: ['title'],\n    additionalProperties: false\n};\n/**\n * Schema for the root fragment template\n */\nexport const FragmentTemplateSchema = {\n    type: 'object',\n    properties: {\n        title: { type: 'string', nullable: true },\n        entityType: {\n            type: 'string',\n            enum: ['fund', 'scenario', 'portfolio', 'transaction', 'custom'],\n            nullable: true\n        },\n        sections: {\n            type: 'array',\n            items: SectionTemplateSchema\n        },\n        footer: { type: 'string', nullable: true }\n    },\n    required: ['sections'],\n    additionalProperties: false\n};\n//# sourceMappingURL=schemas.js.map","/**\n * Fuzzy matching utilities for key suggestions\n * Uses Levenshtein distance for finding similar keys\n */\n/**\n * Calculate Levenshtein distance between two strings\n */\nexport function levenshteinDistance(a, b) {\n    const matrix = [];\n    // Initialize first column\n    for (let i = 0; i <= a.length; i++) {\n        matrix[i] = [i];\n    }\n    // Initialize first row\n    for (let j = 0; j <= b.length; j++) {\n        matrix[0][j] = j;\n    }\n    // Fill in the rest of the matrix\n    for (let i = 1; i <= a.length; i++) {\n        for (let j = 1; j <= b.length; j++) {\n            const cost = a[i - 1] === b[j - 1] ? 0 : 1;\n            matrix[i][j] = Math.min(matrix[i - 1][j] + 1, // deletion\n            matrix[i][j - 1] + 1, // insertion\n            matrix[i - 1][j - 1] + cost // substitution\n            );\n        }\n    }\n    return matrix[a.length][b.length];\n}\n/**\n * Find the closest matching key from a list of valid keys\n * @param input - The key that wasn't found\n * @param validKeys - List of valid keys to search\n * @param maxDistance - Maximum edit distance to consider (default: 3)\n * @returns The closest key, or undefined if none are close enough\n */\nexport function findClosestKey(input, validKeys, maxDistance = 3) {\n    if (validKeys.length === 0)\n        return undefined;\n    const inputLower = input.toLowerCase();\n    let bestMatch;\n    let bestDistance = Infinity;\n    for (const key of validKeys) {\n        const keyLower = key.toLowerCase();\n        // Exact case-insensitive match\n        if (inputLower === keyLower) {\n            return key;\n        }\n        // Check if input is a substring or key is a substring\n        if (inputLower.includes(keyLower) || keyLower.includes(inputLower)) {\n            const distance = Math.abs(inputLower.length - keyLower.length);\n            if (distance < bestDistance) {\n                bestDistance = distance;\n                bestMatch = key;\n            }\n            continue;\n        }\n        // Levenshtein distance\n        const distance = levenshteinDistance(inputLower, keyLower);\n        if (distance < bestDistance && distance <= maxDistance) {\n            bestDistance = distance;\n            bestMatch = key;\n        }\n    }\n    return bestMatch;\n}\n/**\n * Find multiple similar keys, sorted by relevance\n * @param input - The key that wasn't found\n * @param validKeys - List of valid keys to search\n * @param maxResults - Maximum number of suggestions (default: 3)\n * @returns Array of similar keys\n */\nexport function findSimilarKeys(input, validKeys, maxResults = 3) {\n    if (validKeys.length === 0)\n        return [];\n    const inputLower = input.toLowerCase();\n    const scored = validKeys\n        .map(key => ({\n        key,\n        distance: levenshteinDistance(inputLower, key.toLowerCase())\n    }))\n        .filter(({ distance }) => distance <= 4) // Filter out very different keys\n        .sort((a, b) => a.distance - b.distance);\n    return scored.slice(0, maxResults).map(({ key }) => key);\n}\n//# sourceMappingURL=fuzzyMatch.js.map","/**\n * Core template validation logic\n * Two-stage validation: Schema (AJV) + Semantic (custom)\n */\nimport Ajv from 'ajv';\nimport { FragmentTemplateSchema } from './schemas.js';\nimport { findClosestKey } from './fuzzyMatch.js';\n// Create AJV instance with all errors enabled\nconst ajv = new Ajv({ allErrors: true, verbose: true });\n// Compile the schema\nconst validateSchema = ajv.compile(FragmentTemplateSchema);\n/**\n * Validate a template against schema and data keys\n * @param template - The template to validate (unknown for parsing)\n * @param dataKeys - Available keys in the data\n * @returns Validation result with errors\n */\nexport function validateTemplate(template, dataKeys) {\n    const errors = [];\n    // Stage 1: Schema validation\n    const valid = validateSchema(template);\n    if (!valid && validateSchema.errors) {\n        for (const error of validateSchema.errors) {\n            const path = error.instancePath.replace(/^\\//, '').replace(/\\//g, '.') || 'root';\n            let message = error.message || 'Invalid value';\n            let suggestion;\n            // Enhance error messages\n            if (error.keyword === 'enum') {\n                const allowedValues = error.params.allowedValues;\n                suggestion = `Valid values: ${allowedValues.join(', ')}`;\n            }\n            else if (error.keyword === 'required') {\n                const missingProp = error.params.missingProperty;\n                message = `Missing required property: ${missingProp}`;\n            }\n            else if (error.keyword === 'additionalProperties') {\n                const extraProp = error.params.additionalProperty;\n                message = `Unknown property: ${extraProp}`;\n                suggestion = 'Remove this property or check spelling';\n            }\n            errors.push({ path, message, suggestion });\n        }\n        return { valid: false, errors };\n    }\n    // Stage 2: Semantic validation (key existence)\n    const typedTemplate = template;\n    for (let sectionIndex = 0; sectionIndex < typedTemplate.sections.length; sectionIndex++) {\n        const section = typedTemplate.sections[sectionIndex];\n        const sectionPath = `sections[${sectionIndex}]`;\n        // Validate table sections\n        if (section.layout === 'table') {\n            if (!section.columns || section.columns.length === 0) {\n                errors.push({\n                    path: `${sectionPath}.columns`,\n                    message: 'Table layout requires columns array',\n                    suggestion: 'Add columns: [{ header: \"...\", key: \"...\" }]'\n                });\n            }\n            if (!section.dataKey) {\n                errors.push({\n                    path: `${sectionPath}.dataKey`,\n                    message: 'Table layout requires dataKey to reference the data array',\n                    suggestion: 'Add dataKey: \"yourArrayKey\"'\n                });\n            }\n            else if (!dataKeys.includes(section.dataKey)) {\n                const closest = findClosestKey(section.dataKey, dataKeys);\n                errors.push({\n                    path: `${sectionPath}.dataKey`,\n                    message: `Unknown dataKey '${section.dataKey}'`,\n                    suggestion: closest ? `Did you mean '${closest}'?` : undefined\n                });\n            }\n            // Skip field validation for table sections\n            continue;\n        }\n        // Validate chart sections\n        if (section.layout === 'chart') {\n            if (!section.chart) {\n                errors.push({\n                    path: `${sectionPath}.chart`,\n                    message: 'Chart layout requires a chart specification',\n                    suggestion: 'Add chart: { spec: { mark: \"bar\", encoding: {...} } }'\n                });\n            }\n            else {\n                // Validate chart spec has required properties\n                if (!section.chart.spec) {\n                    errors.push({\n                        path: `${sectionPath}.chart.spec`,\n                        message: 'Chart requires a Vega-Lite spec',\n                        suggestion: 'Add spec: { mark: \"bar\", encoding: {...}, data: {...} }'\n                    });\n                }\n                else {\n                    // Check for mark or layer/concat\n                    const spec = section.chart.spec;\n                    const hasContent = spec.mark || spec.layer || spec.vconcat || spec.hconcat;\n                    if (!hasContent) {\n                        errors.push({\n                            path: `${sectionPath}.chart.spec`,\n                            message: 'Chart spec requires mark, layer, vconcat, or hconcat',\n                            suggestion: 'Add mark: \"bar\" or mark: \"line\" etc.'\n                        });\n                    }\n                }\n                // Validate dataKey if provided\n                if (section.chart.dataKey && !dataKeys.includes(section.chart.dataKey)) {\n                    const closest = findClosestKey(section.chart.dataKey, dataKeys);\n                    errors.push({\n                        path: `${sectionPath}.chart.dataKey`,\n                        message: `Unknown dataKey '${section.chart.dataKey}'`,\n                        suggestion: closest ? `Did you mean '${closest}'?` : undefined\n                    });\n                }\n            }\n            // Skip field validation for chart sections\n            continue;\n        }\n        // Validate non-table/non-chart sections have fields\n        if (!section.fields || section.fields.length === 0) {\n            errors.push({\n                path: `${sectionPath}.fields`,\n                message: 'Non-table/chart sections require fields array',\n                suggestion: 'Add fields: [{ label: \"...\", key: \"...\" }]'\n            });\n            continue;\n        }\n        for (let fieldIndex = 0; fieldIndex < section.fields.length; fieldIndex++) {\n            const field = section.fields[fieldIndex];\n            const path = `${sectionPath}.fields[${fieldIndex}]`;\n            // Check if key exists in data\n            if (!dataKeys.includes(field.key)) {\n                const closest = findClosestKey(field.key, dataKeys);\n                errors.push({\n                    path: `${path}.key`,\n                    message: `Unknown key '${field.key}'`,\n                    suggestion: closest ? `Did you mean '${closest}'?` : undefined\n                });\n            }\n            // Check format compatibility (basic type checking)\n            if (field.format) {\n                const formatErrors = validateFormatCompatibility(field, path);\n                errors.push(...formatErrors);\n            }\n            // Check select options\n            if (field.inputType === 'select' && (!field.options || field.options.length === 0)) {\n                errors.push({\n                    path: `${path}.options`,\n                    message: 'Select input type requires options array',\n                    suggestion: 'Add options: [{ label: \"...\", value: \"...\" }]'\n                });\n            }\n            // Check min/max for number inputs\n            if (field.min !== undefined && field.max !== undefined && field.min > field.max) {\n                errors.push({\n                    path: `${path}.min`,\n                    message: `min (${field.min}) cannot be greater than max (${field.max})`,\n                    suggestion: 'Swap min and max values'\n                });\n            }\n        }\n    }\n    return {\n        valid: errors.length === 0,\n        errors\n    };\n}\n/**\n * Validate format compatibility\n */\nfunction validateFormatCompatibility(field, path) {\n    const errors = [];\n    // Check decimals is only used with number/currency/percent\n    if (field.decimals !== undefined) {\n        const validFormats = ['number', 'currency', 'percent'];\n        if (field.format && !validFormats.includes(field.format)) {\n            errors.push({\n                path: `${path}.decimals`,\n                message: `'decimals' only applies to number, currency, or percent formats`,\n                suggestion: `Remove 'decimals' or change format to one of: ${validFormats.join(', ')}`\n            });\n        }\n    }\n    // Check currency is only used with currency format\n    if (field.currency !== undefined && field.format !== 'currency') {\n        errors.push({\n            path: `${path}.currency`,\n            message: `'currency' only applies to currency format`,\n            suggestion: `Set format: 'currency' or remove 'currency' property`\n        });\n    }\n    // Check inputType compatibility with format\n    if (field.inputType && field.format) {\n        const compatMap = {\n            text: ['text'],\n            number: ['number', 'text'],\n            currency: ['number', 'text'],\n            percent: ['number', 'text'],\n            date: ['date', 'text'],\n            boolean: ['checkbox']\n        };\n        const validInputs = compatMap[field.format];\n        if (validInputs && !validInputs.includes(field.inputType)) {\n            errors.push({\n                path: `${path}.inputType`,\n                message: `inputType '${field.inputType}' is not compatible with format '${field.format}'`,\n                suggestion: `Use one of: ${validInputs.join(', ')}`\n            });\n        }\n    }\n    return errors;\n}\n/**\n * Parse and validate a JSON string as a template\n * @param jsonString - JSON string to parse\n * @param dataKeys - Available data keys\n * @returns Validation result with parsed template if valid\n */\nexport function parseAndValidateTemplate(jsonString, dataKeys) {\n    // Try to parse JSON\n    let parsed;\n    try {\n        parsed = JSON.parse(jsonString);\n    }\n    catch (err) {\n        const message = err instanceof Error ? err.message : 'Invalid JSON';\n        return {\n            valid: false,\n            errors: [{\n                    path: 'root',\n                    message: `JSON parse error: ${message}`,\n                    suggestion: 'Check JSON syntax (missing quotes, commas, brackets)'\n                }]\n        };\n    }\n    // Validate the parsed template\n    const result = validateTemplate(parsed, dataKeys);\n    if (result.valid) {\n        return {\n            ...result,\n            template: parsed\n        };\n    }\n    return result;\n}\n//# sourceMappingURL=validateTemplate.js.map","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n/**\n * FieldRenderer component\n * Renders a single field with formatting and optional edit capability\n */\nimport { useMemo, useState, useCallback } from 'react';\n// Styles as constants\nconst styles = {\n    container: {\n        display: 'flex',\n        flexDirection: 'column',\n        gap: '2px',\n        minWidth: 0, // Allow text truncation\n    },\n    label: {\n        fontSize: '11px',\n        fontWeight: 500,\n        color: 'var(--gray-11, #6b7280)',\n        textTransform: 'uppercase',\n        letterSpacing: '0.5px',\n    },\n    value: {\n        fontSize: '14px',\n        fontWeight: 500,\n        color: 'var(--gray-12, #1f2937)',\n        fontFamily: 'var(--font-mono, ui-monospace, monospace)',\n        fontVariantNumeric: 'tabular-nums',\n        letterSpacing: '-0.02em',\n    },\n    unit: {\n        fontSize: '12px',\n        color: 'var(--gray-10, #9ca3af)',\n        marginLeft: '4px',\n    },\n    highlight: {\n        success: { color: 'var(--green-11, #15803d)' },\n        warning: { color: 'var(--yellow-11, #ca8a04)' },\n        error: { color: 'var(--red-11, #dc2626)' },\n        info: { color: 'var(--blue-11, #2563eb)' },\n    },\n    editable: {\n        cursor: 'pointer',\n        padding: '2px 4px',\n        borderRadius: '4px',\n        transition: 'background-color 0.15s',\n    },\n    tooltip: {\n        position: 'relative',\n    },\n    nullValue: {\n        color: 'var(--gray-9, #9ca3af)',\n        fontStyle: 'italic',\n    },\n};\n/**\n * Format a value according to the field's format specification\n */\nfunction formatValue(value, field) {\n    if (value === null || value === undefined) {\n        return '\\u2014'; // em-dash for null/undefined\n    }\n    switch (field.format) {\n        case 'number': {\n            const num = typeof value === 'number' ? value : parseFloat(String(value));\n            if (isNaN(num))\n                return String(value);\n            const options = {\n                minimumFractionDigits: field.decimals ?? 0,\n                maximumFractionDigits: field.decimals ?? 2,\n            };\n            return new Intl.NumberFormat('en-US', options).format(num);\n        }\n        case 'currency': {\n            const num = typeof value === 'number' ? value : parseFloat(String(value));\n            if (isNaN(num))\n                return String(value);\n            const options = {\n                style: 'currency',\n                currency: field.currency || 'USD',\n                minimumFractionDigits: field.decimals ?? 0,\n                maximumFractionDigits: field.decimals ?? 0,\n            };\n            return new Intl.NumberFormat('en-US', options).format(num);\n        }\n        case 'percent': {\n            const num = typeof value === 'number' ? value : parseFloat(String(value));\n            if (isNaN(num))\n                return String(value);\n            // Assume value is already a percentage (e.g., 25 for 25%)\n            // If it's a decimal (e.g., 0.25), multiply by 100\n            const pct = num < 1 && num > -1 && num !== 0 ? num * 100 : num;\n            const decimals = field.decimals ?? 1;\n            return `${pct.toFixed(decimals)}%`;\n        }\n        case 'date': {\n            if (!value)\n                return '\\u2014';\n            const date = value instanceof Date ? value : new Date(String(value));\n            if (isNaN(date.getTime()))\n                return String(value);\n            return new Intl.DateTimeFormat('en-US', {\n                year: 'numeric',\n                month: 'short',\n                day: 'numeric',\n            }).format(date);\n        }\n        case 'boolean': {\n            const bool = typeof value === 'boolean' ? value : value === 'true' || value === '1';\n            return bool ? 'Yes' : 'No';\n        }\n        case 'text':\n        default:\n            return String(value);\n    }\n}\n/**\n * FieldRenderer component\n * Displays a field with label, formatted value, and optional highlighting\n */\nexport function FieldRenderer({ field, value, onUpdate, agentMode, }) {\n    const [isHovered, setIsHovered] = useState(false);\n    const formattedValue = useMemo(() => formatValue(value, field), [value, field]);\n    const isNull = value === null || value === undefined;\n    const isEditable = field.editable && (onUpdate || agentMode);\n    const handleClick = useCallback(() => {\n        if (!isEditable)\n            return;\n        if (agentMode?.enabled && agentMode.sendMessage) {\n            // Send message to agent for editing\n            agentMode.sendMessage(`Please help me update the \"${field.label}\" field (key: ${field.key}). Current value: ${formattedValue}`);\n        }\n        // Direct edit mode would go here (Phase 2)\n    }, [isEditable, agentMode, field, formattedValue]);\n    const valueStyle = useMemo(() => {\n        const base = { ...styles.value };\n        if (isNull) {\n            return { ...base, ...styles.nullValue };\n        }\n        if (field.highlight) {\n            return { ...base, ...styles.highlight[field.highlight] };\n        }\n        if (isEditable) {\n            return {\n                ...base,\n                ...styles.editable,\n                backgroundColor: isHovered ? 'var(--gray-3, #f3f4f6)' : 'transparent',\n            };\n        }\n        return base;\n    }, [isNull, field.highlight, isEditable, isHovered]);\n    return (_jsxs(\"div\", { style: styles.container, title: field.tooltip, onMouseEnter: () => setIsHovered(true), onMouseLeave: () => setIsHovered(false), onClick: handleClick, role: isEditable ? 'button' : undefined, tabIndex: isEditable ? 0 : undefined, children: [_jsx(\"span\", { style: styles.label, children: field.label }), _jsxs(\"span\", { style: valueStyle, children: [formattedValue, field.unit && !isNull && (_jsx(\"span\", { style: styles.unit, children: field.unit }))] })] }));\n}\n//# sourceMappingURL=FieldRenderer.js.map","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n/**\n * TableRenderer component\n * Renders a table with columns and row data\n */\nimport { useMemo } from 'react';\nconst styles = {\n    container: {\n        width: '100%',\n        overflowX: 'auto',\n    },\n    table: {\n        width: '100%',\n        borderCollapse: 'collapse',\n        fontSize: '13px',\n    },\n    thead: {\n        backgroundColor: 'var(--gray-3, #f3f4f6)',\n    },\n    th: {\n        padding: '10px 12px',\n        textAlign: 'left',\n        fontWeight: 600,\n        fontSize: '11px',\n        textTransform: 'uppercase',\n        letterSpacing: '0.5px',\n        color: 'var(--gray-11, #6b7280)',\n        borderBottom: '2px solid var(--gray-5, #e5e7eb)',\n    },\n    td: {\n        padding: '10px 12px',\n        borderBottom: '1px solid var(--gray-4, #e5e7eb)',\n        fontFamily: 'var(--font-mono, ui-monospace, monospace)',\n        fontVariantNumeric: 'tabular-nums',\n    },\n    trHover: {\n        backgroundColor: 'var(--gray-2, #f9fafb)',\n    },\n    empty: {\n        padding: '20px',\n        textAlign: 'center',\n        color: 'var(--gray-10, #9ca3af)',\n        fontStyle: 'italic',\n    },\n    highlight: {\n        success: { color: 'var(--green-11, #15803d)' },\n        warning: { color: 'var(--yellow-11, #ca8a04)' },\n        error: { color: 'var(--red-11, #dc2626)' },\n        info: { color: 'var(--blue-11, #2563eb)' },\n    },\n};\n/**\n * Format a cell value according to column format\n */\nfunction formatCellValue(value, column) {\n    if (value === null || value === undefined) {\n        return 'â€”';\n    }\n    switch (column.format) {\n        case 'number': {\n            const num = typeof value === 'number' ? value : parseFloat(String(value));\n            if (isNaN(num))\n                return String(value);\n            return new Intl.NumberFormat('en-US', {\n                minimumFractionDigits: 0,\n                maximumFractionDigits: column.decimals ?? 2,\n            }).format(num);\n        }\n        case 'currency': {\n            const num = typeof value === 'number' ? value : parseFloat(String(value));\n            if (isNaN(num))\n                return String(value);\n            return new Intl.NumberFormat('en-US', {\n                style: 'currency',\n                currency: column.currency || 'USD',\n                minimumFractionDigits: column.decimals ?? 0,\n                maximumFractionDigits: column.decimals ?? 0,\n            }).format(num);\n        }\n        case 'percent': {\n            const num = typeof value === 'number' ? value : parseFloat(String(value));\n            if (isNaN(num))\n                return String(value);\n            const pct = num < 1 && num > -1 && num !== 0 ? num * 100 : num;\n            return `${pct.toFixed(column.decimals ?? 1)}%`;\n        }\n        case 'date': {\n            const date = value instanceof Date ? value : new Date(String(value));\n            if (isNaN(date.getTime()))\n                return String(value);\n            return new Intl.DateTimeFormat('en-US', {\n                year: 'numeric',\n                month: 'short',\n                day: 'numeric',\n            }).format(date);\n        }\n        case 'boolean':\n            return value ? 'Yes' : 'No';\n        default:\n            return String(value);\n    }\n}\n/**\n * TableRenderer component\n */\nexport function TableRenderer({ columns, rows }) {\n    const alignmentStyle = useMemo(() => {\n        return columns.reduce((acc, col) => {\n            acc[col.key] = col.align || (col.format === 'number' || col.format === 'currency' || col.format === 'percent'\n                ? 'right'\n                : 'left');\n            return acc;\n        }, {});\n    }, [columns]);\n    if (rows.length === 0) {\n        return (_jsx(\"div\", { style: styles.container, children: _jsxs(\"table\", { style: styles.table, children: [_jsx(\"thead\", { style: styles.thead, children: _jsx(\"tr\", { children: columns.map((col) => (_jsx(\"th\", { style: {\n                                    ...styles.th,\n                                    textAlign: alignmentStyle[col.key],\n                                    width: col.width,\n                                }, children: col.header }, col.key))) }) }), _jsx(\"tbody\", { children: _jsx(\"tr\", { children: _jsx(\"td\", { colSpan: columns.length, style: styles.empty, children: \"No data available\" }) }) })] }) }));\n    }\n    return (_jsx(\"div\", { style: styles.container, children: _jsxs(\"table\", { style: styles.table, children: [_jsx(\"thead\", { style: styles.thead, children: _jsx(\"tr\", { children: columns.map((col) => (_jsx(\"th\", { style: {\n                                ...styles.th,\n                                textAlign: alignmentStyle[col.key],\n                                width: col.width,\n                            }, children: col.header }, col.key))) }) }), _jsx(\"tbody\", { children: rows.map((row, rowIndex) => (_jsx(\"tr\", { children: columns.map((col) => {\n                            const value = row[col.key];\n                            const formatted = formatCellValue(value, col);\n                            const cellStyle = {\n                                ...styles.td,\n                                textAlign: alignmentStyle[col.key],\n                                ...(col.highlight ? styles.highlight[col.highlight] : {}),\n                            };\n                            return (_jsx(\"td\", { style: cellStyle, children: formatted }, col.key));\n                        }) }, rowIndex))) })] }) }));\n}\n//# sourceMappingURL=TableRenderer.js.map","import { jsx as _jsx } from \"react/jsx-runtime\";\n/**\n * Context provider for FusionFragment components\n * Provides data and update handlers to nested components\n */\nimport { createContext, useContext, useMemo } from 'react';\nconst FusionFragmentContext = createContext(null);\n/**\n * Provider component that supplies data and update handlers\n * to FusionFragment components via context\n *\n * @example\n * ```tsx\n * <FusionFragmentProvider\n *   data={fund.parameters}\n *   onUpdate={async (key, value) => {\n *     await api.funds.updateParameters(fundId, { [key]: value });\n *   }}\n * >\n *   <MarkdownRenderer content={agentResponse} />\n * </FusionFragmentProvider>\n * ```\n */\nexport function FusionFragmentProvider({ data, onUpdate, sendMessage, ChartComponent, artifactRunId, children }) {\n    const value = useMemo(() => ({ data, onUpdate, sendMessage, ChartComponent, artifactRunId }), [data, onUpdate, sendMessage, ChartComponent, artifactRunId]);\n    // Debug logging\n    console.log('[FusionFragmentProvider] Created with:', {\n        hasData: !!data,\n        dataKeys: data ? Object.keys(data) : [],\n        hasChartComponent: !!ChartComponent,\n        artifactRunId,\n    });\n    return (_jsx(FusionFragmentContext.Provider, { value: value, children: children }));\n}\n/**\n * Hook to access FusionFragment context\n * @throws Error if used outside of FusionFragmentProvider\n */\nexport function useFusionFragmentContext() {\n    const context = useContext(FusionFragmentContext);\n    if (!context) {\n        throw new Error('useFusionFragmentContext must be used within a FusionFragmentProvider');\n    }\n    return context;\n}\n/**\n * Hook to safely access FusionFragment context\n * Returns null if not within a provider (useful for optional context)\n */\nexport function useFusionFragmentContextSafe() {\n    return useContext(FusionFragmentContext);\n}\n//# sourceMappingURL=FusionFragmentContext.js.map","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useFusionFragmentContextSafe } from './FusionFragmentContext.js';\n/**\n * Renders a Vega-Lite chart from a chart template.\n * If dataKey is provided, it merges data from context into the spec.\n * Uses the ChartComponent from FusionFragmentContext if available.\n */\nexport function ChartRenderer({ chart, data, className }) {\n    const context = useFusionFragmentContextSafe();\n    const ChartComponent = context?.ChartComponent;\n    const artifactRunId = context?.artifactRunId;\n    // Debug logging\n    console.log('[ChartRenderer] Context:', {\n        hasContext: !!context,\n        hasChartComponent: !!ChartComponent,\n        artifactRunId,\n        chartTitle: chart.title,\n        dataKey: chart.dataKey,\n    });\n    // Resolve data from context if dataKey is provided\n    const resolvedSpec = { ...chart.spec };\n    if (chart.dataKey && data[chart.dataKey]) {\n        const chartData = data[chart.dataKey];\n        if (Array.isArray(chartData)) {\n            // Inject data into spec\n            resolvedSpec.data = { values: chartData };\n        }\n    }\n    // Build the VegaLiteChartSpec format expected by @vertesia/ui\n    const vegaSpec = {\n        library: 'vega-lite',\n        title: chart.title,\n        description: chart.description,\n        spec: resolvedSpec,\n        options: {\n            height: chart.height,\n        }\n    };\n    // If a ChartComponent is provided via context, use it to render the actual chart\n    if (ChartComponent) {\n        return (_jsx(\"div\", { className: className, children: _jsx(ChartComponent, { spec: vegaSpec, artifactRunId: artifactRunId }) }));\n    }\n    // Fallback: render a placeholder with spec info when no ChartComponent is injected\n    return (_jsxs(\"div\", { className: className, style: {\n            padding: '16px',\n            backgroundColor: 'var(--gray-2, #f9fafb)',\n            border: '1px solid var(--gray-5, #e5e7eb)',\n            borderRadius: '8px',\n            minHeight: chart.height || 280\n        }, children: [chart.title && (_jsx(\"div\", { style: {\n                    fontSize: '14px',\n                    fontWeight: 600,\n                    marginBottom: '8px',\n                    color: 'var(--gray-12, #111827)'\n                }, children: chart.title })), chart.description && (_jsx(\"div\", { style: {\n                    fontSize: '12px',\n                    color: 'var(--gray-11, #6b7280)',\n                    marginBottom: '12px'\n                }, children: chart.description })), _jsx(\"div\", { style: {\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    height: (chart.height || 280) - 60,\n                    backgroundColor: 'var(--gray-3, #f3f4f6)',\n                    borderRadius: '4px',\n                    color: 'var(--gray-11, #6b7280)',\n                    fontSize: '12px'\n                }, \"data-vega-spec\": JSON.stringify(vegaSpec), children: _jsxs(\"div\", { style: { textAlign: 'center' }, children: [_jsxs(\"div\", { style: { marginBottom: '4px' }, children: [\"Chart: \", resolvedSpec.mark ? String(typeof resolvedSpec.mark === 'string' ? resolvedSpec.mark : resolvedSpec.mark.type) : 'composite'] }), resolvedSpec.data?.values && (_jsxs(\"div\", { style: { fontSize: '11px', opacity: 0.8 }, children: [resolvedSpec.data.values.length, \" data points\"] }))] }) })] }));\n}\n//# sourceMappingURL=ChartRenderer.js.map","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n/**\n * SectionRenderer component\n * Renders a section with grid layout and collapsible behavior\n */\nimport { useState, useMemo } from 'react';\nimport { FieldRenderer } from './FieldRenderer.js';\nimport { TableRenderer } from './TableRenderer.js';\nimport { ChartRenderer } from './ChartRenderer.js';\n// Layout grid configurations\nconst gridLayouts = {\n    'grid-2': {\n        display: 'grid',\n        gridTemplateColumns: 'repeat(2, 1fr)',\n        gap: '16px',\n    },\n    'grid-3': {\n        display: 'grid',\n        gridTemplateColumns: 'repeat(3, 1fr)',\n        gap: '16px',\n    },\n    'grid-4': {\n        display: 'grid',\n        gridTemplateColumns: 'repeat(4, 1fr)',\n        gap: '16px',\n    },\n    list: {\n        display: 'flex',\n        flexDirection: 'column',\n        gap: '12px',\n    },\n};\nconst styles = {\n    section: {\n        marginBottom: '20px',\n    },\n    header: {\n        display: 'flex',\n        alignItems: 'center',\n        gap: '8px',\n        marginBottom: '12px',\n        cursor: 'default',\n    },\n    headerCollapsible: {\n        cursor: 'pointer',\n        userSelect: 'none',\n    },\n    title: {\n        fontSize: '11px',\n        fontWeight: 600,\n        color: 'var(--gray-11, #6b7280)',\n        textTransform: 'uppercase',\n        letterSpacing: '0.5px',\n    },\n    chevron: {\n        width: '14px',\n        height: '14px',\n        color: 'var(--gray-10, #9ca3af)',\n        transition: 'transform 0.2s',\n    },\n    chevronCollapsed: {\n        transform: 'rotate(-90deg)',\n    },\n    content: {\n        overflow: 'hidden',\n        transition: 'max-height 0.2s ease-out',\n    },\n    contentCollapsed: {\n        maxHeight: '0',\n        opacity: 0,\n    },\n    contentExpanded: {\n        maxHeight: '2000px', // Large enough for most content\n        opacity: 1,\n    },\n    divider: {\n        height: '1px',\n        backgroundColor: 'var(--gray-5, #e5e7eb)',\n        marginTop: '16px',\n    },\n};\n// Simple chevron SVG component\nfunction ChevronIcon({ collapsed }) {\n    return (_jsx(\"svg\", { style: {\n            ...styles.chevron,\n            ...(collapsed ? styles.chevronCollapsed : {}),\n        }, viewBox: \"0 0 24 24\", fill: \"none\", stroke: \"currentColor\", strokeWidth: \"2\", strokeLinecap: \"round\", strokeLinejoin: \"round\", children: _jsx(\"polyline\", { points: \"6 9 12 15 18 9\" }) }));\n}\n/**\n * SectionRenderer component\n * Displays a section with title, optional collapse, and grid of fields\n */\nexport function SectionRenderer({ section, data, onUpdate, agentMode, }) {\n    const [isCollapsed, setIsCollapsed] = useState(section.collapsed ?? false);\n    const layout = section.layout || 'grid-3';\n    const isTable = layout === 'table';\n    const isChart = layout === 'chart';\n    const layoutStyle = isTable || isChart ? {} : gridLayouts[layout];\n    const isCollapsible = section.collapsed !== undefined;\n    // Get table rows from data\n    const tableRows = useMemo(() => {\n        if (!isTable || !section.dataKey)\n            return [];\n        const rows = data[section.dataKey];\n        return Array.isArray(rows) ? rows : [];\n    }, [isTable, section.dataKey, data]);\n    const headerStyle = useMemo(() => ({\n        ...styles.header,\n        ...(isCollapsible ? styles.headerCollapsible : {}),\n    }), [isCollapsible]);\n    const contentStyle = useMemo(() => ({\n        ...styles.content,\n        ...layoutStyle,\n        ...(isCollapsed ? styles.contentCollapsed : styles.contentExpanded),\n    }), [isCollapsed, layoutStyle]);\n    const handleHeaderClick = () => {\n        if (isCollapsible) {\n            setIsCollapsed(!isCollapsed);\n        }\n    };\n    // Render content based on layout type\n    const renderContent = () => {\n        if (isTable && section.columns) {\n            return _jsx(TableRenderer, { columns: section.columns, rows: tableRows });\n        }\n        if (isChart && section.chart) {\n            return _jsx(ChartRenderer, { chart: section.chart, data: data });\n        }\n        // Default: render fields\n        return section.fields?.map((field, index) => (_jsx(FieldRenderer, { field: field, value: data[field.key], onUpdate: onUpdate ? (value) => onUpdate(field.key, value) : undefined, agentMode: agentMode }, field.key || index)));\n    };\n    return (_jsxs(\"div\", { style: styles.section, children: [_jsxs(\"div\", { style: headerStyle, onClick: handleHeaderClick, role: isCollapsible ? 'button' : undefined, \"aria-expanded\": isCollapsible ? !isCollapsed : undefined, children: [isCollapsible && _jsx(ChevronIcon, { collapsed: isCollapsed }), _jsx(\"span\", { style: styles.title, children: section.title })] }), _jsx(\"div\", { style: contentStyle, children: renderContent() })] }));\n}\n//# sourceMappingURL=SectionRenderer.js.map","import { jsxs as _jsxs, jsx as _jsx } from \"react/jsx-runtime\";\n/**\n * FusionFragmentRenderer - Main component\n * Renders a model-generated template with actual data values\n */\nimport { useMemo } from 'react';\nimport { validateTemplate } from '../validation/validateTemplate.js';\nimport { SectionRenderer } from './SectionRenderer.js';\nconst styles = {\n    container: {\n        backgroundColor: 'var(--gray-2, #f9fafb)',\n        border: '1px solid var(--gray-5, #e5e7eb)',\n        borderRadius: '8px',\n        padding: '16px 20px',\n    },\n    title: {\n        fontSize: '16px',\n        fontWeight: 600,\n        color: 'var(--gray-12, #1f2937)',\n        marginBottom: '16px',\n        paddingBottom: '12px',\n        borderBottom: '1px solid var(--gray-5, #e5e7eb)',\n    },\n    footer: {\n        fontSize: '12px',\n        color: 'var(--gray-10, #9ca3af)',\n        marginTop: '16px',\n        paddingTop: '12px',\n        borderTop: '1px solid var(--gray-5, #e5e7eb)',\n    },\n    error: {\n        backgroundColor: 'var(--red-2, #fef2f2)',\n        border: '1px solid var(--red-6, #fca5a5)',\n        borderRadius: '8px',\n        padding: '16px',\n    },\n    errorTitle: {\n        fontSize: '14px',\n        fontWeight: 600,\n        color: 'var(--red-11, #dc2626)',\n        marginBottom: '12px',\n    },\n    errorList: {\n        listStyle: 'none',\n        padding: 0,\n        margin: 0,\n    },\n    errorItem: {\n        fontSize: '13px',\n        color: 'var(--red-11, #dc2626)',\n        marginBottom: '8px',\n        fontFamily: 'var(--font-mono, ui-monospace, monospace)',\n    },\n    errorPath: {\n        fontSize: '11px',\n        color: 'var(--red-9, #ef4444)',\n        display: 'block',\n    },\n    errorSuggestion: {\n        fontSize: '12px',\n        color: 'var(--gray-11, #6b7280)',\n        marginTop: '4px',\n        fontStyle: 'italic',\n    },\n};\n/**\n * Component to display validation errors\n */\nfunction ValidationErrors({ errors }) {\n    return (_jsxs(\"div\", { style: styles.error, children: [_jsxs(\"div\", { style: styles.errorTitle, children: [\"Template Validation Failed (\", errors.length, \" error\", errors.length > 1 ? 's' : '', \")\"] }), _jsx(\"ul\", { style: styles.errorList, children: errors.map((error, index) => (_jsxs(\"li\", { style: styles.errorItem, children: [_jsx(\"span\", { children: error.message }), _jsxs(\"span\", { style: styles.errorPath, children: [\"at \", error.path] }), error.suggestion && (_jsxs(\"span\", { style: styles.errorSuggestion, children: [\"\\\\u2192 \", error.suggestion] }))] }, index))) })] }));\n}\n/**\n * FusionFragmentRenderer - Main renderer component\n *\n * Takes a model-generated template and actual data, validates the template,\n * and renders the UI with proper formatting and layout.\n *\n * @example\n * ```tsx\n * <FusionFragmentRenderer\n *   template={{\n *     title: \"Fund Parameters\",\n *     sections: [{\n *       title: \"Identity\",\n *       layout: \"grid-3\",\n *       fields: [\n *         { label: \"Firm Name\", key: \"firmName\" },\n *         { label: \"Vintage\", key: \"vintageYear\", format: \"number\" }\n *       ]\n *     }]\n *   }}\n *   data={{ firmName: \"Acme Capital\", vintageYear: 2024 }}\n * />\n * ```\n */\nexport function FusionFragmentRenderer({ template, data, onUpdate, agentMode, className, }) {\n    // Validate template against data keys\n    const validation = useMemo(() => {\n        const dataKeys = Object.keys(data);\n        return validateTemplate(template, dataKeys);\n    }, [template, data]);\n    // Show validation errors if any\n    if (!validation.valid) {\n        return _jsx(ValidationErrors, { errors: validation.errors });\n    }\n    return (_jsxs(\"div\", { style: styles.container, className: className, children: [template.title && (_jsx(\"div\", { style: styles.title, children: template.title })), template.sections.map((section, index) => (_jsx(SectionRenderer, { section: section, data: data, onUpdate: onUpdate, agentMode: agentMode }, section.title || index))), template.footer && (_jsx(\"div\", { style: styles.footer, children: template.footer }))] }));\n}\n//# sourceMappingURL=FusionFragmentRenderer.js.map","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n/**\n * FusionFragmentHandler - Code block handler component\n * Parses fusion-fragment code blocks and renders them\n */\nimport { useMemo } from 'react';\nimport { parseAndValidateTemplate } from '../validation/validateTemplate.js';\nimport { FusionFragmentRenderer } from './FusionFragmentRenderer.js';\nimport { useFusionFragmentContextSafe } from './FusionFragmentContext.js';\nconst styles = {\n    error: {\n        backgroundColor: 'var(--red-2, #fef2f2)',\n        border: '1px solid var(--red-6, #fca5a5)',\n        borderRadius: '8px',\n        padding: '16px',\n        fontFamily: 'var(--font-mono, ui-monospace, monospace)',\n        fontSize: '13px',\n    },\n    errorTitle: {\n        fontWeight: 600,\n        color: 'var(--red-11, #dc2626)',\n        marginBottom: '8px',\n    },\n    errorMessage: {\n        color: 'var(--red-10, #ef4444)',\n        whiteSpace: 'pre-wrap',\n    },\n    noContext: {\n        backgroundColor: 'var(--yellow-2, #fefce8)',\n        border: '1px solid var(--yellow-6, #fde047)',\n        borderRadius: '8px',\n        padding: '16px',\n    },\n    noContextTitle: {\n        fontSize: '14px',\n        fontWeight: 600,\n        color: 'var(--yellow-11, #ca8a04)',\n        marginBottom: '8px',\n    },\n    noContextMessage: {\n        fontSize: '13px',\n        color: 'var(--gray-11, #6b7280)',\n    },\n    loading: {\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        gap: '12px',\n        minHeight: '150px',\n        borderRadius: '8px',\n        border: '1px solid var(--gray-6, #e5e7eb)',\n        backgroundColor: 'var(--gray-2, #f9fafb)',\n    },\n    loadingIcon: {\n        width: '32px',\n        height: '32px',\n        color: 'var(--gray-9, #9ca3af)',\n    },\n    loadingText: {\n        fontSize: '14px',\n        color: 'var(--gray-9, #9ca3af)',\n    },\n    loadingDots: {\n        display: 'flex',\n        gap: '4px',\n    },\n    loadingDot: {\n        width: '8px',\n        height: '8px',\n        borderRadius: '50%',\n        backgroundColor: 'var(--gray-6, #d1d5db)',\n        animation: 'fusion-fragment-bounce 1s infinite',\n    },\n};\n/**\n * Check if JSON parsing failed due to incomplete content (streaming)\n * vs actually invalid JSON structure\n */\nfunction isIncompleteJson(code) {\n    const trimmed = code.trim();\n    // Empty or very short content is likely incomplete\n    if (trimmed.length < 2)\n        return true;\n    // Must start with { for a valid JSON object\n    if (!trimmed.startsWith('{'))\n        return false;\n    // Try to parse - if it succeeds, it's not incomplete\n    try {\n        JSON.parse(trimmed);\n        return false; // Valid JSON\n    }\n    catch (e) {\n        const message = e instanceof Error ? e.message : '';\n        // Common indicators of incomplete JSON during streaming\n        const incompleteIndicators = [\n            'unexpected end',\n            'unterminated string',\n            'expected',\n            'unexpected token',\n        ];\n        const lowerMessage = message.toLowerCase();\n        if (incompleteIndicators.some(ind => lowerMessage.includes(ind))) {\n            // Additional check: count brackets to see if they're unbalanced\n            let braceCount = 0;\n            let bracketCount = 0;\n            let inString = false;\n            let escaped = false;\n            for (const char of trimmed) {\n                if (escaped) {\n                    escaped = false;\n                    continue;\n                }\n                if (char === '\\\\') {\n                    escaped = true;\n                    continue;\n                }\n                if (char === '\"') {\n                    inString = !inString;\n                    continue;\n                }\n                if (!inString) {\n                    if (char === '{')\n                        braceCount++;\n                    else if (char === '}')\n                        braceCount--;\n                    else if (char === '[')\n                        bracketCount++;\n                    else if (char === ']')\n                        bracketCount--;\n                }\n            }\n            // If brackets are unbalanced or we're in an unclosed string, it's incomplete\n            return braceCount > 0 || bracketCount > 0 || inString;\n        }\n        // For other parse errors, consider it invalid rather than incomplete\n        return false;\n    }\n}\n/**\n * Loading placeholder shown while streaming incomplete JSON\n */\nfunction LoadingPlaceholder() {\n    return (_jsxs(\"div\", { style: styles.loading, children: [_jsx(\"style\", { children: `\n        @keyframes fusion-fragment-bounce {\n          0%, 80%, 100% { transform: translateY(0); }\n          40% { transform: translateY(-6px); }\n        }\n      ` }), _jsxs(\"svg\", { style: styles.loadingIcon, viewBox: \"0 0 24 24\", fill: \"none\", stroke: \"currentColor\", strokeWidth: \"2\", strokeLinecap: \"round\", strokeLinejoin: \"round\", children: [_jsx(\"polyline\", { points: \"16 18 22 12 16 6\" }), _jsx(\"polyline\", { points: \"8 6 2 12 8 18\" })] }), _jsx(\"span\", { style: styles.loadingText, children: \"Loading fragment...\" }), _jsx(\"div\", { style: styles.loadingDots, children: [0, 1, 2].map(i => (_jsx(\"div\", { style: {\n                        ...styles.loadingDot,\n                        animationDelay: `${i * 150}ms`,\n                    } }, i))) })] }));\n}\n/**\n * Error display component\n */\nfunction ParseError({ message }) {\n    return (_jsxs(\"div\", { style: styles.error, children: [_jsx(\"div\", { style: styles.errorTitle, children: \"Failed to parse fusion-fragment\" }), _jsx(\"div\", { style: styles.errorMessage, children: message })] }));\n}\n/**\n * Warning when no context is available\n */\nfunction NoContextWarning({ template }) {\n    const requiredKeys = template.sections\n        .flatMap(s => s.fields || [])\n        .map(f => f.key);\n    return (_jsxs(\"div\", { style: styles.noContext, children: [_jsx(\"div\", { style: styles.noContextTitle, children: \"No data context available\" }), _jsxs(\"div\", { style: styles.noContextMessage, children: [\"This fusion-fragment requires data with keys: \", requiredKeys.join(', '), \".\", _jsx(\"br\", {}), \"Wrap this component in a FusionFragmentProvider with the required data.\"] })] }));\n}\n/**\n * FusionFragmentHandler - Handles fusion-fragment code blocks\n *\n * This component is designed to be used as a code block renderer.\n * It parses the JSON template from the code block and renders it\n * using data from the FusionFragmentContext.\n *\n * @example\n * ```tsx\n * // In your markdown renderer:\n * const codeBlockRenderers = {\n *   'fusion-fragment': ({ code }) => <FusionFragmentHandler code={code} />\n * };\n * ```\n */\nexport function FusionFragmentHandler({ code, data: propData, onUpdate: propOnUpdate, }) {\n    // Try to get context (may be null if no provider)\n    const context = useFusionFragmentContextSafe();\n    // Use prop data or context data\n    const data = propData ?? context?.data;\n    const onUpdate = propOnUpdate ?? context?.onUpdate;\n    const sendMessage = context?.sendMessage;\n    // Check if JSON is incomplete (streaming) - show loading placeholder\n    const incomplete = useMemo(() => isIncompleteJson(code), [code]);\n    // Parse and validate the template (only if not obviously incomplete)\n    const result = useMemo(() => {\n        if (incomplete) {\n            return { valid: false, errors: [], template: undefined };\n        }\n        const dataKeys = data ? Object.keys(data) : [];\n        return parseAndValidateTemplate(code, dataKeys);\n    }, [code, data, incomplete]);\n    // Show loading placeholder for incomplete JSON (streaming in progress)\n    if (incomplete) {\n        return _jsx(LoadingPlaceholder, {});\n    }\n    // Parse error\n    if (!result.valid && !result.template) {\n        const parseError = result.errors.find(e => e.path === 'root' && e.message.includes('JSON'));\n        if (parseError) {\n            return _jsx(ParseError, { message: parseError.message });\n        }\n    }\n    // Template parsed but no data available\n    if (result.template && !data) {\n        return _jsx(NoContextWarning, { template: result.template });\n    }\n    // Template parsed but validation errors (show errors in renderer)\n    if (result.template && data) {\n        return (_jsx(FusionFragmentRenderer, { template: result.template, data: data, onUpdate: onUpdate, agentMode: sendMessage ? { enabled: true, sendMessage } : undefined }));\n    }\n    // Fallback for any other error case\n    return (_jsx(ParseError, { message: result.errors.map(e => `${e.path}: ${e.message}`).join('\\n') }));\n}\n/**\n * Factory function to create a code block renderer configuration\n * for use with markdown renderers that support custom code blocks\n */\nexport function createFusionFragmentCodeBlockRenderer() {\n    return {\n        language: 'fusion-fragment',\n        component: FusionFragmentHandler,\n    };\n}\n//# sourceMappingURL=FusionFragmentHandler.js.map","/**\n * Error formatting utilities for model-friendly output\n */\n/**\n * Format validation errors as a model-friendly string\n * @param errors - Array of validation errors\n * @returns Formatted error message\n */\nexport function formatValidationErrors(errors) {\n    if (errors.length === 0) {\n        return 'Template is valid.';\n    }\n    const header = `Template validation failed with ${errors.length} error${errors.length > 1 ? 's' : ''}:\\n`;\n    const formattedErrors = errors.map((error, index) => {\n        let message = `${index + 1}. ${error.message}`;\n        message += `\\n   Path: ${error.path}`;\n        if (error.suggestion) {\n            message += `\\n   \\u2192 ${error.suggestion}`;\n        }\n        return message;\n    });\n    return header + '\\n' + formattedErrors.join('\\n\\n');\n}\n/**\n * Format a successful validation with preview info\n * @param template - The validated template\n * @param dataKeys - Available data keys\n * @returns Success message with preview\n */\nexport function formatValidationSuccess(template, dataKeys) {\n    const lines = ['Template valid. Preview:'];\n    lines.push('');\n    if (template.title) {\n        lines.push(`**${template.title}**`);\n        lines.push('');\n    }\n    for (const section of template.sections) {\n        const fieldCount = section.fields.length;\n        lines.push(`[${section.title}] ${fieldCount} field${fieldCount > 1 ? 's' : ''}:`);\n        for (const field of section.fields) {\n            let fieldDesc = `- ${field.label} (${field.key}`;\n            if (field.format && field.format !== 'text') {\n                fieldDesc += `, ${field.format}`;\n            }\n            fieldDesc += ')';\n            // Check if key exists in data\n            if (!dataKeys.includes(field.key)) {\n                fieldDesc += ' \\u26a0\\ufe0f key not in data';\n            }\n            lines.push(fieldDesc);\n        }\n        lines.push('');\n    }\n    return lines.join('\\n');\n}\n/**\n * Format a list of available keys for model reference\n * @param dataKeys - Available data keys\n * @param groupByPrefix - Whether to group keys by common prefix\n * @returns Formatted key list\n */\nexport function formatAvailableKeys(dataKeys, groupByPrefix = true) {\n    if (dataKeys.length === 0) {\n        return 'No data keys available.';\n    }\n    if (!groupByPrefix || dataKeys.length <= 10) {\n        return `Available keys: ${dataKeys.join(', ')}`;\n    }\n    // Group by prefix (e.g., fund.name, fund.type -> fund.*)\n    const groups = new Map();\n    for (const key of dataKeys) {\n        const dotIndex = key.indexOf('.');\n        if (dotIndex > 0) {\n            const prefix = key.substring(0, dotIndex);\n            const rest = key.substring(dotIndex + 1);\n            const group = groups.get(prefix) || [];\n            group.push(rest);\n            groups.set(prefix, group);\n        }\n        else {\n            const group = groups.get('') || [];\n            group.push(key);\n            groups.set('', group);\n        }\n    }\n    const lines = ['Available keys:'];\n    // Top-level keys first\n    const topLevel = groups.get('');\n    if (topLevel && topLevel.length > 0) {\n        lines.push(`  ${topLevel.join(', ')}`);\n    }\n    // Grouped keys\n    for (const [prefix, keys] of groups) {\n        if (prefix === '')\n            continue;\n        if (keys.length <= 3) {\n            lines.push(`  ${prefix}: ${keys.join(', ')}`);\n        }\n        else {\n            lines.push(`  ${prefix}: ${keys.slice(0, 3).join(', ')}, ... (${keys.length} total)`);\n        }\n    }\n    return lines.join('\\n');\n}\n//# sourceMappingURL=formatErrors.js.map","/**\n * Text preview generation for non-vision models\n * Generates a text description of what the fragment will look like\n */\n/**\n * Generate sample data for preview rendering\n * Creates placeholder values based on field definitions\n */\nexport function generateSampleData(template, dataKeys) {\n    const data = {};\n    // Add provided data keys with placeholder values\n    for (const key of dataKeys) {\n        data[key] = `<${key}>`;\n    }\n    // Override with more specific placeholders based on field format\n    for (const section of template.sections) {\n        if (section.fields) {\n            for (const field of section.fields) {\n                if (field.key in data) {\n                    data[field.key] = getSampleValue(field);\n                }\n            }\n        }\n    }\n    return data;\n}\n/**\n * Get a sample value for a field based on its format\n */\nfunction getSampleValue(field) {\n    switch (field.format) {\n        case 'number':\n            return 1234;\n        case 'currency':\n            return 1000000;\n        case 'percent':\n            return 25;\n        case 'date':\n            return new Date().toISOString().split('T')[0];\n        case 'boolean':\n            return true;\n        case 'text':\n        default:\n            return `Sample ${field.label}`;\n    }\n}\n/**\n * Generate a text description of the template for preview\n * Used for non-vision models\n */\nexport function generateTextPreview(template, dataKeys) {\n    const lines = [];\n    lines.push('Template structure preview:');\n    lines.push('');\n    if (template.title) {\n        lines.push(`## ${template.title}`);\n        lines.push('');\n    }\n    for (const section of template.sections) {\n        const layout = section.layout || 'grid-3';\n        lines.push(`### ${section.title}`);\n        if (layout === 'table') {\n            lines.push(`Layout: table`);\n            if (section.dataKey) {\n                lines.push(`Data key: \\`${section.dataKey}\\``);\n            }\n            lines.push('');\n            if (section.columns) {\n                lines.push('Columns:');\n                for (const col of section.columns) {\n                    let colLine = `- **${col.header}** \\u2192 \\`${col.key}\\``;\n                    if (col.format && col.format !== 'text') {\n                        colLine += ` (${col.format})`;\n                    }\n                    lines.push(colLine);\n                }\n            }\n        }\n        else if (layout === 'chart') {\n            lines.push(`Layout: chart`);\n            if (section.chart) {\n                const chart = section.chart;\n                if (chart.title) {\n                    lines.push(`Chart title: ${chart.title}`);\n                }\n                if (chart.description) {\n                    lines.push(`Description: ${chart.description}`);\n                }\n                const markType = chart.spec.mark\n                    ? (typeof chart.spec.mark === 'string' ? chart.spec.mark : chart.spec.mark.type || 'unknown')\n                    : 'composite';\n                lines.push(`Chart type: ${markType}`);\n                if (chart.dataKey) {\n                    lines.push(`Data key: \\`${chart.dataKey}\\``);\n                    if (!dataKeys.includes(chart.dataKey)) {\n                        lines.push('\\u26a0\\ufe0f **dataKey not found in data**');\n                    }\n                }\n                else if (chart.spec.data?.values) {\n                    lines.push(`Inline data: ${chart.spec.data.values.length} points`);\n                }\n                if (chart.height) {\n                    lines.push(`Height: ${chart.height}px`);\n                }\n            }\n            lines.push('');\n        }\n        else {\n            const layoutDesc = layout === 'list' ? 'vertical list' : `${layout.split('-')[1]}-column grid`;\n            lines.push(`Layout: ${layoutDesc}${section.collapsed ? ' (collapsed by default)' : ''}`);\n            lines.push('');\n            if (section.fields) {\n                for (const field of section.fields) {\n                    let fieldLine = `- **${field.label}** \\u2192 \\`${field.key}\\``;\n                    const attributes = [];\n                    if (field.format && field.format !== 'text') {\n                        attributes.push(field.format);\n                    }\n                    if (field.unit) {\n                        attributes.push(`unit: \"${field.unit}\"`);\n                    }\n                    if (field.editable) {\n                        attributes.push('editable');\n                    }\n                    if (field.highlight) {\n                        attributes.push(`highlight: ${field.highlight}`);\n                    }\n                    if (attributes.length > 0) {\n                        fieldLine += ` (${attributes.join(', ')})`;\n                    }\n                    // Check if key exists in data\n                    if (!dataKeys.includes(field.key)) {\n                        fieldLine += ' \\u26a0\\ufe0f **key not found in data**';\n                    }\n                    lines.push(fieldLine);\n                }\n            }\n        }\n        lines.push('');\n    }\n    if (template.footer) {\n        lines.push('---');\n        lines.push(`Footer: ${template.footer}`);\n        lines.push('');\n    }\n    // Summary\n    const totalFields = template.sections.reduce((sum, s) => sum + (s.fields?.length || 0) + (s.columns?.length || 0), 0);\n    const missingKeys = template.sections\n        .flatMap(s => s.fields || [])\n        .filter(f => !dataKeys.includes(f.key))\n        .map(f => f.key);\n    lines.push('---');\n    lines.push(`Summary: ${template.sections.length} section(s), ${totalFields} field(s)/column(s)`);\n    if (missingKeys.length > 0) {\n        lines.push(`\\u26a0\\ufe0f Missing keys: ${missingKeys.join(', ')}`);\n    }\n    else {\n        lines.push('\\u2705 All field keys found in data');\n    }\n    return lines.join('\\n');\n}\n/**\n * Generate a compact description for tool responses\n */\nexport function generateCompactPreview(template) {\n    const sections = template.sections.map(s => {\n        if (s.layout === 'table' && s.columns) {\n            const colList = s.columns\n                .slice(0, 3)\n                .map(c => c.header)\n                .join(', ');\n            const more = s.columns.length > 3 ? `, +${s.columns.length - 3} more` : '';\n            return `${s.title} (table): ${colList}${more}`;\n        }\n        if (s.layout === 'chart' && s.chart) {\n            const markType = s.chart.spec.mark\n                ? (typeof s.chart.spec.mark === 'string' ? s.chart.spec.mark : s.chart.spec.mark.type || 'chart')\n                : 'chart';\n            return `${s.title} (${markType} chart)`;\n        }\n        if (s.fields) {\n            const fieldList = s.fields\n                .slice(0, 3)\n                .map(f => f.label)\n                .join(', ');\n            const more = s.fields.length > 3 ? `, +${s.fields.length - 3} more` : '';\n            return `${s.title}: ${fieldList}${more}`;\n        }\n        return s.title;\n    });\n    const title = template.title ? `\"${template.title}\" - ` : '';\n    return `${title}${sections.join(' | ')}`;\n}\n//# sourceMappingURL=textPreview.js.map"],"names":["FieldTemplateSchema","type","properties","label","key","format","enum","nullable","unit","editable","inputType","options","items","value","required","additionalProperties","min","max","highlight","tooltip","decimals","currency","SectionTemplateSchema","title","layout","collapsed","fields","columns","header","width","align","dataKey","chart","description","spec","height","FragmentTemplateSchema","entityType","sections","footer","levenshteinDistance","a","b","matrix","i","length","j","cost","Math","findClosestKey","input","validKeys","maxDistance","inputLower","toLowerCase","bestMatch","bestDistance","Infinity","keyLower","includes","distance","abs","findSimilarKeys","maxResults","map","filter","sort","slice","validateSchema","Ajv","allErrors","verbose","compile","validateTemplate","template","dataKeys","errors","error","path","instancePath","replace","suggestion","message","keyword","params","allowedValues","join","missingProperty","additionalProperty","push","valid","typedTemplate","sectionIndex","section","sectionPath","fieldIndex","field","closest","undefined","formatErrors","validateFormatCompatibility","mark","layer","vconcat","hconcat","validFormats","validInputs","text","number","percent","date","boolean","parseAndValidateTemplate","jsonString","parsed","JSON","parse","err","Error","result","styles","container","display","flexDirection","gap","minWidth","fontSize","fontWeight","color","textTransform","letterSpacing","fontFamily","fontVariantNumeric","marginLeft","success","warning","info","cursor","padding","borderRadius","transition","nullValue","fontStyle","FieldRenderer","onUpdate","agentMode","isHovered","setIsHovered","useState","formattedValue","useMemo","num","parseFloat","String","isNaN","minimumFractionDigits","maximumFractionDigits","Intl","NumberFormat","style","pct","toFixed","Date","getTime","DateTimeFormat","year","month","day","formatValue","isNull","isEditable","handleClick","useCallback","enabled","sendMessage","valueStyle","base","backgroundColor","_jsxs","onMouseEnter","onMouseLeave","onClick","role","tabIndex","children","_jsx","overflowX","table","borderCollapse","thead","th","textAlign","borderBottom","td","empty","TableRenderer","rows","alignmentStyle","reduce","acc","col","colSpan","row","rowIndex","formatted","column","formatCellValue","cellStyle","FusionFragmentContext","createContext","FusionFragmentProvider","data","ChartComponent","artifactRunId","console","log","hasData","Object","keys","hasChartComponent","Provider","useFusionFragmentContext","context","useContext","useFusionFragmentContextSafe","ChartRenderer","className","hasContext","chartTitle","resolvedSpec","chartData","Array","isArray","values","vegaSpec","library","border","minHeight","marginBottom","alignItems","justifyContent","stringify","opacity","gridLayouts","gridTemplateColumns","list","headerCollapsible","userSelect","chevron","chevronCollapsed","transform","content","overflow","contentCollapsed","maxHeight","contentExpanded","ChevronIcon","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","points","SectionRenderer","isCollapsed","setIsCollapsed","isTable","isChart","layoutStyle","isCollapsible","tableRows","headerStyle","contentStyle","index","paddingBottom","marginTop","paddingTop","borderTop","errorTitle","errorList","listStyle","margin","errorItem","errorPath","errorSuggestion","ValidationErrors","FusionFragmentRenderer","validation","errorMessage","whiteSpace","noContext","noContextTitle","noContextMessage","loading","loadingIcon","loadingText","loadingDots","loadingDot","animation","LoadingPlaceholder","animationDelay","ParseError","NoContextWarning","requiredKeys","flatMap","s","f","FusionFragmentHandler","code","propData","propOnUpdate","incomplete","trimmed","trim","startsWith","e","incompleteIndicators","lowerMessage","some","ind","braceCount","bracketCount","inString","escaped","char","isIncompleteJson","parseError","find","createFusionFragmentCodeBlockRenderer","language","component","formatValidationErrors","formatValidationSuccess","lines","fieldCount","fieldDesc","formatAvailableKeys","groupByPrefix","groups","Map","dotIndex","indexOf","prefix","substring","rest","group","get","set","topLevel","generateSampleData","getSampleValue","toISOString","split","generateTextPreview","colLine","markType","layoutDesc","fieldLine","attributes","totalFields","sum","missingKeys","generateCompactPreview","colList","c","more","fieldList"],"mappings":"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"}